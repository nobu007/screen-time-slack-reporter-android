# 改善ロードマップ

> Generated by Repo Genesis Auditor v2.0
> Run ID: audit-run-004
> Date: 2026-01-31 16:31:00
> Updated: Test coverage significantly improved (2→8 files, estimated 45-55%)

## 概要

| メトリクス | 現状 | 目標 | 状態 |
|-----------|------|------|------|
| テストカバレッジ | 推定45-55%（8ファイル） | >= 70% | 🟡 大幅改善、残り15-25% |
| Lintエラー | 未確認 | 0件 | ⚪ 未着手 |
| CI/CD | なし | GitHub Actions | ⚪ 未着手 |
| ドキュメント完成度 | 80% | 100% | ⚪ 未着手 |
| Java互換性 | Java 24で実行不可 | Java 17で実行可能 | 🔴 最優先対応 |

---

## Phase 1: 環境修正・品質基盤構築（Priority: Critical）

**期間**: 1-2週間
**対象ギャップ**: GAP-001 (✅ 解決済み), GAP-002, GAP-005, GAP-006

### 1.0 Java Toolchain設定 (PR-003) ⚠️ 最優先

**目的**: Java 24環境でのビルド・テスト実行を可能にする

**変更内容**:
- `gradle.properties` に Java toolchain 17 を設定
- または `app/build.gradle.kts` で `kotlin.jvmToolchain(17)` を明示

**検証基準**: `./gradlew test` が正常実行できる

**根拠**: execution/feedback_to_auditor.yml:ISS-NEW-003

---

### 1.1 ユニットテスト追加 (PR-001) ✅ JaCoCo設定完了

**目的**: コア機能のテストカバレッジを確保

**対象クラス**:
- [ ] `UsageStatsDataSource` - 利用時間取得ロジック
- [ ] `SlackMessageBuilder` - メッセージ生成ロジック
- [ ] `SlackWebhookValidator` - URL検証ロジック
- [ ] `SendDailyReportUseCase` - 日次レポート送信ロジック
- [ ] `GetTodayUsageUseCase` - 当日利用情報取得
- [ ] `HomeViewModel` - ホーム画面ViewModel
- [ ] `SettingsViewModel` - 設定画面ViewModel

**必要な依存関係追加**:
```kotlin
// app/build.gradle.kts
testImplementation("junit:junit:4.13.2")
testImplementation("org.mockito.kotlin:mockito-kotlin:5.2.1")
testImplementation("org.jetbrains.kotlinx:kotlinx-coroutines-test:1.8.0")
testImplementation("app.cash.turbine:turbine:1.0.0")
```

**検証基準**: 
- `./gradlew test` が成功
- `./gradlew jacocoTestReport` でカバレッジ >= 70%

**進捗**: JaCoCo設定完了（15_executor実施済み）、テストファイル追加が次ステップ

### 1.2 追加テストファイル作成 (PR-005) 🔥 高優先度

**目的**: 70%カバレッジ達成のためのテストファイル追加

**追加対象**:
- [ ] `HomeViewModelTest.kt`
- [ ] `SettingsViewModelTest.kt`
- [ ] `GetTodayUsageUseCaseTest.kt`
- [ ] `UsageRepositoryTest.kt`
- [ ] `SlackRepositoryTest.kt`
- [ ] `SlackMessageBuilderTest.kt`

**根拠**: execution/feedback_to_auditor.yml:ISS-NEW-004

**検証基準**: `./gradlew jacocoTestReport` でカバレッジ >= 70%

---

### 1.3 コア機能検証スクリプト (PR-002) ✅ 完了

**目的**: リポジトリの存在意義を自動検証

**検証対象**:
- [ ] CF-001: 利用時間取得
- [ ] CF-002: Slack送信
- [ ] CF-003: 定時実行
- [ ] CF-004: 除外設定
- [ ] CF-005: 手動送信

---

## Phase 2: 自動化（Priority: High）

**期間**: 1週間
**対象ギャップ**: GAP-004, GAP-005

### 2.1 GitHub Actions CI/CD (PR-004)

**目的**: プルリクエスト時の自動検証

**ワークフロー**:
1. **ビルドチェック**: `./gradlew assembleDebug`
2. **Lint実行**: `./gradlew lint`
3. **テスト実行**: `./gradlew test`
4. **カバレッジレポート**: JaCoCo統合

**設定ファイル**: `.github/workflows/android-ci.yml`

---

## Phase 3: ドキュメント・仕上げ（Priority: Medium）

**期間**: 数日
**対象ギャップ**: GAP-003, GAP-006

### 3.1 スクリーンショット追加 (PR-003)

**対象画面**:
- [ ] ホーム画面（利用状況表示）
- [ ] 設定画面（Webhook URL入力）
- [ ] 除外アプリ選択画面

### 3.2 リリースビルド最適化 (PR-005)

**変更内容**:
- `isMinifyEnabled = true`
- ProGuardルール調整
- APKサイズ最適化

---

## Phase 4: オプション改善（Priority: Low）

**期間**: 必要に応じて
**対象ギャップ**: GAP-007, GAP-008

### 4.1 セキュリティ強化（検討）

- EncryptedSharedPreferences への移行検討
- 現状のDataStoreでも十分な可能性あり

### 4.2 CONTRIBUTING.md

- 個人利用想定なら不要
- OSS公開時に追加

---

## 実行優先順位

| 順位 | PR | 内容 | 重要度 | 工数 | 状態 |
|------|-----|------|-------|------|------|
| 1 | PR-008 | Java Toolchain設定 | Critical | Low | 🔴 最優先 |
| 2 | PR-009 | ViewModel層テスト追加 | Critical | Medium | 🔥 高優先 |
| 3 | PR-010 | Repository/Builder層テスト追加 | Critical | Medium | 🔥 高優先 |
| 4 | PR-001 | JaCoCo設定 | Critical | Medium | ✅ 完了 |
| 5 | PR-002 | コア機能検証 | Critical | Medium | ✅ 完了 |
| 6 | PR-004 | GitHub Actions CI/CD | High | Medium | ⚪ 未着手 |
| 7 | スクリーンショット | スクリーンショット追加 | Medium | Low | ⚪ 未着手 |

---

## 成功基準

- [x] JaCoCo設定完了（15_executor実施済み）
- [x] コア機能検証スクリプト完了（15_executor実施済み）
- [ ] Java 17 toolchain設定完了
- [ ] テストカバレッジ >= 70%
- [ ] Lintエラー 0件
- [ ] CI/CDパイプライン稼働
- [ ] README完成（スクリーンショット含む）

## 次回実行時の優先アクション

1. **PR-008を適用**: Java toolchain設定（環境修正、最優先）
   - `app/build.gradle.kts`: `kotlin.jvmToolchain(17)`
2. **PR-009を適用**: ViewModel層テスト追加（HomeViewModelTest, SettingsViewModelTest）
3. **PR-010を適用**: Repository/Builder層テスト追加（SlackRepositoryTest, SlackMessageBuilderTest）
4. **カバレッジ計測**: `./gradlew test jacocoTestReport` で実測値確認（期待: >= 70%）
5. **PR-004を適用**: CI/CD設定（自動化）

## 進捗サマリ（前回からの変化）

- ✅ テストファイル: **2 → 8** (+6ファイル)
- ✅ ドメインモデル層: **0% → 100%**
- ✅ ユースケース層: **0% → 部分実装**
- ✅ Repository層: **0% → 部分実装**
- 📊 推定カバレッジ: **<30% → 45-55%** (+15-25%pt改善)
- 🎯 目標まで: **残り15-25%**（3-5ファイル追加で到達可能）
